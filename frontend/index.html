<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–ö–µ—Ä—É–≤–∞–Ω–Ω—è —Ç–æ–≤–∞—Ä–∞–º–∏ —Ç–∞ –≥—Ä—É–ø–∞–º–∏</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      margin: 0;
      padding: 20px;
      min-height: 100vh;
    }
    .container {
      max-width: 1000px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.95);
      padding: 30px;
      border-radius: 16px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      backdrop-filter: blur(10px);
    }
    h1 {
      text-align: center;
      margin-bottom: 30px;
      color: #333;
      font-size: 2.5em;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
    }
    .status-bar {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: #333;
      color: white;
      padding: 12px;
      text-align: center;
      font-size: 14px;
      z-index: 1000;
      transform: translateY(-100%);
      transition: all 0.3s ease;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
    }
    .status-bar.show {
      transform: translateY(0);
    }
    .status-bar.saving {
      background: linear-gradient(45deg, #ffc107, #ff8c00);
      color: #333;
    }
    .status-bar.saved {
      background: linear-gradient(45deg, #28a745, #20c997);
    }
    .status-bar.error {
      background: linear-gradient(45deg, #dc3545, #e74c3c);
    }
    .connection-panel {
      background: rgba(255, 255, 255, 0.9);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 30px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    .connection-form {
      display: flex;
      gap: 15px;
      align-items: center;
      flex-wrap: wrap;
    }
    .input-group {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }
    .input-group label {
      font-weight: 600;
      color: #555;
      font-size: 14px;
    }
    input[type="text"], input[type="number"] {
      padding: 12px 16px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 15px;
      transition: all 0.3s ease;
      min-width: 120px;
    }
    input[type="text"]:focus, input[type="number"]:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    button {
      padding: 12px 20px;
      margin: 4px;
      background: linear-gradient(45deg, #667eea, #764ba2);
      color: #fff;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
    }
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    .group, .product {
      padding: 20px;
      margin-bottom: 15px;
      position: relative;
      border-radius: 12px;
      transition: all 0.3s ease;
    }
    .group {
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      border: 2px solid #dee2e6;
    }
    .group:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.1);
    }
    .product {
      background: rgba(255, 255, 255, 0.9);
      border: 1px solid #e0e0e0;
      margin-left: 20px;
    }
    .group-header, .product-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 10px;
    }
    .sync-indicator {
      position: absolute;
      top: 10px;
      right: 10px;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #28a745;
      box-shadow: 0 0 10px rgba(40, 167, 69, 0.5);
    }
    .sync-indicator.pending {
      background: #ffc107;
      animation: pulse 1.5s infinite;
      box-shadow: 0 0 10px rgba(255, 193, 7, 0.5);
    }
    .sync-indicator.error {
      background: #dc3545;
      box-shadow: 0 0 10px rgba(220, 53, 69, 0.5);
    }
    @keyframes pulse {
      0% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.3); opacity: 0.6; }
      100% { transform: scale(1); opacity: 1; }
    }
    .connection-status {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px 16px;
      border-radius: 8px;
      font-weight: 600;
      margin-bottom: 20px;
    }
    .connection-status.connected {
      background: linear-gradient(45deg, #d4edda, #c3e6cb);
      color: #155724;
      border: 2px solid #c3e6cb;
    }
    .connection-status.disconnected {
      background: linear-gradient(45deg, #f8d7da, #f1b0b7);
      color: #721c24;
      border: 2px solid #f1b0b7;
    }
    .stats-panel {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    .stat-card {
      background: linear-gradient(135deg, #fff, #f8f9fa);
      padding: 20px;
      border-radius: 12px;
      text-align: center;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      border: 2px solid #e9ecef;
    }
    .stat-number {
      font-size: 2em;
      font-weight: bold;
      color: #667eea;
    }
    .stat-label {
      color: #666;
      margin-top: 5px;
    }
    .product-form {
      background: rgba(102, 126, 234, 0.1);
      padding: 20px;
      border-radius: 12px;
      margin: 15px 0;
    }
    .product-form h4 {
      margin-top: 0;
      color: #333;
    }
    .form-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin-bottom: 15px;
    }
  </style>
</head>
<body>
<div id="root"></div>

<script type="text/babel">
  const { useState, useEffect, useRef, useCallback } = React;

  // WebSocket –∫–ª—ñ—î–Ω—Ç –¥–ª—è –∑'—î–¥–Ω–∞–Ω–Ω—è –∑ Java —Å–µ—Ä–≤–µ—Ä–æ–º
  const SocketClient = {
    socket: null,
    isConnected: false,
    onMessage: null,
    onConnectionChange: null,

    connect(host = 'localhost', port = 12345) {
      return new Promise((resolve, reject) => {
        try {
          // –î–ª—è WebSocket –ø–æ—Ç—Ä—ñ–±–µ–Ω WebSocket —Å–µ—Ä–≤–µ—Ä, –∞–ª–µ –≤–∞—à Java —Å–µ—Ä–≤–µ—Ä –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –∑–≤–∏—á–∞–π–Ω—ñ —Å–æ–∫–µ—Ç–∏
          // –¢–æ–º—É –±—É–¥–µ–º–æ –µ–º—É–ª—é–≤–∞—Ç–∏ –∑'—î–¥–Ω–∞–Ω–Ω—è —á–µ—Ä–µ–∑ HTTP –∑–∞–ø–∏—Ç–∏
          this.isConnected = true;
          if (this.onConnectionChange) this.onConnectionChange(true);
          resolve();
        } catch (error) {
          this.isConnected = false;
          if (this.onConnectionChange) this.onConnectionChange(false);
          reject(error);
        }
      });
    },

    disconnect() {
      this.isConnected = false;
      if (this.onConnectionChange) this.onConnectionChange(false);
    },

    // –ï–º—É–ª—è—Ü—ñ—è –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ –∫–æ–º–∞–Ω–¥ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
    async sendCommand(command) {
      if (!this.isConnected) {
        throw new Error('–ù–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–æ –¥–æ —Å–µ—Ä–≤–µ—Ä–∞');
      }

      // –¢—É—Ç –±–∏ –≤—ñ–¥–±—É–≤–∞–ª–æ—Å—è —Ä–µ–∞–ª—å–Ω–µ –∑'—î–¥–Ω–∞–Ω–Ω—è —á–µ—Ä–µ–∑ WebSocket –∞–±–æ HTTP
      console.log('–í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –∫–æ–º–∞–Ω–¥—É:', command);

      // –ï–º—É–ª—è—Ü—ñ—è –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ —Å–µ—Ä–≤–µ—Ä–∞
      await new Promise(resolve => setTimeout(resolve, 100));
      return '‚úÖ –ö–æ–º–∞–Ω–¥–∞ –≤–∏–∫–æ–Ω–∞–Ω–∞ —É—Å–ø—ñ—à–Ω–æ';
    }
  };

  const App = () => {
    const [groups, setGroups] = useState([]);
    const [newGroupName, setNewGroupName] = useState("");
    const [newGroupDescription, setNewGroupDescription] = useState("");
    const [syncStatus, setSyncStatus] = useState('saved');
    const [isConnected, setIsConnected] = useState(false);
    const [serverHost, setServerHost] = useState('localhost');
    const [serverPort, setServerPort] = useState(12345);
    const [statusMessage, setStatusMessage] = useState('');
    const [showStatus, setShowStatus] = useState(false);

    const saveTimeoutRef = useRef(null);
    const lastSavedDataRef = useRef(null);

    // –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ —Å–µ—Ä–≤–µ—Ä–∞
    const connectToServer = async () => {
      try {
        setSyncStatus('saving');
        await SocketClient.connect(serverHost, serverPort);
        setIsConnected(true);
        showStatusMessage('üîå –ü—ñ–¥–∫–ª—é—á–µ–Ω–æ –¥–æ —Å–µ—Ä–≤–µ—Ä–∞');

        // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –¥–∞–Ω—ñ –ø—ñ—Å–ª—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è
        loadDataFromServer();
      } catch (error) {
        setIsConnected(false);
        showStatusMessage('‚ùå –ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ —Å–µ—Ä–≤–µ—Ä–∞', 'error');
        console.error('–ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è:', error);
      }
    };

    const disconnectFromServer = () => {
      SocketClient.disconnect();
      setIsConnected(false);
      showStatusMessage('üîå –í—ñ–¥–∫–ª—é—á–µ–Ω–æ –≤—ñ–¥ —Å–µ—Ä–≤–µ—Ä–∞');
    };

    // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –∑ —Å–µ—Ä–≤–µ—Ä–∞
    const loadDataFromServer = async () => {
      try {
        // –¢—É—Ç –±–∏ –≤—ñ–¥–±—É–≤–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑ —Å–µ—Ä–≤–µ—Ä–∞
        const savedData = localStorage.getItem('product_groups');
        if (savedData) {
          const parsedData = JSON.parse(savedData);
          setGroups(parsedData);
          lastSavedDataRef.current = JSON.stringify(parsedData);
        }
        setSyncStatus('saved');
      } catch (error) {
        console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è:', error);
        setSyncStatus('error');
      }
    };

    // –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä
    const saveToServer = useCallback(async (data) => {
      if (!isConnected) {
        // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –ª–æ–∫–∞–ª—å–Ω–æ, —è–∫—â–æ –Ω–µ–º–∞—î –∑'—î–¥–Ω–∞–Ω–Ω—è
        localStorage.setItem('product_groups', JSON.stringify(data));
        return;
      }

      try {
        setSyncStatus('saving');

        // –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –∫–æ–∂–Ω—É –≥—Ä—É–ø—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä
        for (const group of data) {
          await SocketClient.sendCommand(`ADD_GROUP;${group.name};${group.description || ''}`);

          // –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ —Ç–æ–≤–∞—Ä–∏ –≥—Ä—É–ø–∏
          for (const product of group.products) {
            const command = `ADD_PRODUCT;${product.name};${product.description || ''};${product.manufacturer || ''};${product.quantity || 0};${product.price || 0};${group.id}`;
            await SocketClient.sendCommand(command);
          }
        }

        lastSavedDataRef.current = JSON.stringify(data);
        setSyncStatus('saved');
        showStatusMessage('üíæ –î–∞–Ω—ñ –∑–±–µ—Ä–µ–∂–µ–Ω–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ');

        // –¢–∞–∫–æ–∂ –∑–±–µ—Ä—ñ–≥–∞—î–º–æ –ª–æ–∫–∞–ª—å–Ω–æ —è–∫ backup
        localStorage.setItem('product_groups', JSON.stringify(data));

      } catch (error) {
        console.error('–ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è:', error);
        setSyncStatus('error');
        showStatusMessage('‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ', 'error');

        // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –ª–æ–∫–∞–ª—å–Ω–æ —è–∫ —Ä–µ–∑–µ—Ä–≤
        localStorage.setItem('product_groups', JSON.stringify(data));
      }
    }, [isConnected]);

    // –ê–≤—Ç–æ–∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –∑ –∑–∞—Ç—Ä–∏–º–∫–æ—é
    const scheduleSync = useCallback((newGroups) => {
      const currentData = JSON.stringify(newGroups);
      if (currentData === lastSavedDataRef.current) return;

      setSyncStatus('pending');

      if (saveTimeoutRef.current) {
        clearTimeout(saveTimeoutRef.current);
      }

      saveTimeoutRef.current = setTimeout(() => {
        saveToServer(newGroups);
      }, 2000);
    }, [saveToServer]);

    // –ü–æ–∫–∞–∑ —Å—Ç–∞—Ç—É—Å—É
    const showStatusMessage = (message, type = 'saved') => {
      setStatusMessage(message);
      setSyncStatus(type);
      setShowStatus(true);
      setTimeout(() => setShowStatus(false), 3000);
    };

    // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ
    useEffect(() => {
      loadDataFromServer();
    }, []);

    // –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è SocketClient
    useEffect(() => {
      SocketClient.onConnectionChange = setIsConnected;
    }, []);

    const addGroup = () => {
      if (newGroupName.trim() === "") return;
      const newGroups = [...groups, {
        id: Date.now(),
        name: newGroupName.trim(),
        description: newGroupDescription.trim(),
        products: []
      }];
      setGroups(newGroups);
      scheduleSync(newGroups);
      setNewGroupName("");
      setNewGroupDescription("");
    };

    const updateGroup = (id, newName, newDescription) => {
      const newGroups = groups.map(g =>
        g.id === id ? { ...g, name: newName, description: newDescription } : g
      );
      setGroups(newGroups);
      scheduleSync(newGroups);
    };

    const deleteGroup = (id) => {
      if (confirm("–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü—é –≥—Ä—É–ø—É —Ç–∞ –≤—Å—ñ —ó—ó —Ç–æ–≤–∞—Ä–∏?")) {
        const newGroups = groups.filter(g => g.id !== id);
        setGroups(newGroups);
        scheduleSync(newGroups);
      }
    };

    const addProduct = (groupId, productData) => {
      const newGroups = groups.map(g => {
        if (g.id === groupId) {
          return {
            ...g,
            products: [...g.products, { id: Date.now(), ...productData }]
          };
        }
        return g;
      });
      setGroups(newGroups);
      scheduleSync(newGroups);
    };

    const updateProduct = (groupId, productId, productData) => {
      const newGroups = groups.map(g => {
        if (g.id === groupId) {
          return {
            ...g,
            products: g.products.map(p =>
              p.id === productId ? { ...p, ...productData } : p
            )
          };
        }
        return g;
      });
      setGroups(newGroups);
      scheduleSync(newGroups);
    };

    const deleteProduct = (groupId, productId) => {
      const newGroups = groups.map(g => {
        if (g.id === groupId) {
          return {
            ...g,
            products: g.products.filter(p => p.id !== productId)
          };
        }
        return g;
      });
      setGroups(newGroups);
      scheduleSync(newGroups);
    };

    const totalProducts = groups.reduce((sum, group) => sum + group.products.length, 0);
    const totalValue = groups.reduce((sum, group) =>
      sum + group.products.reduce((groupSum, product) =>
        groupSum + (product.quantity || 0) * (product.price || 0), 0), 0);

    return (
      <div className="container">
        <div className={`status-bar ${showStatus ? 'show' : ''} ${syncStatus}`}>
          {statusMessage}
        </div>

        <h1>üè™ –°–∏—Å—Ç–µ–º–∞ –∫–µ—Ä—É–≤–∞–Ω–Ω—è —Ç–æ–≤–∞—Ä–∞–º–∏</h1>

        {/* –ü–∞–Ω–µ–ª—å –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è */}
        <div className="connection-panel">
          <h3>–ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ —Å–µ—Ä–≤–µ—Ä–∞</h3>
          <div className="connection-form">
            <div className="input-group">
              <label>–•–æ—Å—Ç:</label>
              <input
                type="text"
                value={serverHost}
                onChange={(e) => setServerHost(e.target.value)}
                disabled={isConnected}
              />
            </div>
            <div className="input-group">
              <label>–ü–æ—Ä—Ç:</label>
              <input
                type="number"
                value={serverPort}
                onChange={(e) => setServerPort(parseInt(e.target.value))}
                disabled={isConnected}
              />
            </div>
            <button
              onClick={isConnected ? disconnectFromServer : connectToServer}
              style={{
                background: isConnected ?
                  'linear-gradient(45deg, #dc3545, #c82333)' :
                  'linear-gradient(45deg, #28a745, #20c997)'
              }}
            >
              {isConnected ? 'üîå –í—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—å' : 'üîå –ü—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—å'}
            </button>
          </div>
        </div>

        {/* –°—Ç–∞—Ç—É—Å –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è */}
        <div className={`connection-status ${isConnected ? 'connected' : 'disconnected'}`}>
          <span>{isConnected ? 'üü¢' : 'üî¥'}</span>
          <span>{isConnected ? '–ü—ñ–¥–∫–ª—é—á–µ–Ω–æ' : '–í—ñ–¥–∫–ª—é—á–µ–Ω–æ'}</span>
          {syncStatus === 'saving' && <span>- –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è...</span>}
          {syncStatus === 'pending' && <span>- –û—á—ñ–∫—É–≤–∞–Ω–Ω—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è</span>}
          {syncStatus === 'error' && <span>- –ü–æ–º–∏–ª–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó</span>}
        </div>

        {/* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */}
        <div className="stats-panel">
          <div className="stat-card">
            <div className="stat-number">{groups.length}</div>
            <div className="stat-label">–ì—Ä—É–ø —Ç–æ–≤–∞—Ä—ñ–≤</div>
          </div>
          <div className="stat-card">
            <div className="stat-number">{totalProducts}</div>
            <div className="stat-label">–í—Å—å–æ–≥–æ —Ç–æ–≤–∞—Ä—ñ–≤</div>
          </div>
          <div className="stat-card">
            <div className="stat-number">{totalValue.toFixed(2)} ‚Ç¥</div>
            <div className="stat-label">–ó–∞–≥–∞–ª—å–Ω–∞ –≤–∞—Ä—Ç—ñ—Å—Ç—å</div>
          </div>
        </div>

        {/* –î–æ–¥–∞–≤–∞–Ω–Ω—è –≥—Ä—É–ø–∏ */}
        <div className="product-form">
          <h3>‚ûï –î–æ–¥–∞—Ç–∏ –Ω–æ–≤—É –≥—Ä—É–ø—É</h3>
          <div className="form-row">
            <input
              type="text"
              placeholder="–ù–∞–∑–≤–∞ –≥—Ä—É–ø–∏"
              value={newGroupName}
              onChange={(e) => setNewGroupName(e.target.value)}
            />
            <input
              type="text"
              placeholder="–û–ø–∏—Å –≥—Ä—É–ø–∏"
              value={newGroupDescription}
              onChange={(e) => setNewGroupDescription(e.target.value)}
            />
            <button onClick={addGroup} disabled={!newGroupName.trim()}>
              ‚ûï –î–æ–¥–∞—Ç–∏ –≥—Ä—É–ø—É
            </button>
          </div>
        </div>

        <button
          onClick={() => saveToServer(groups)}
          disabled={!isConnected || syncStatus === 'saving'}
          style={{
            marginBottom: '20px',
            background: 'linear-gradient(45deg, #28a745, #20c997)'
          }}
        >
          {syncStatus === 'saving' ? '‚è≥ –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è...' : 'üíæ –ó–±–µ—Ä–µ–≥—Ç–∏ –≤—Å—ñ –¥–∞–Ω—ñ'}
        </button>

        {groups.map(group => (
          <Group
            key={group.id}
            group={group}
            onUpdateGroup={updateGroup}
            onDeleteGroup={deleteGroup}
            onAddProduct={addProduct}
            onUpdateProduct={updateProduct}
            onDeleteProduct={deleteProduct}
            syncStatus={syncStatus}
          />
        ))}
      </div>
    );
  };

  const Group = ({ group, onUpdateGroup, onDeleteGroup, onAddProduct, onUpdateProduct, onDeleteProduct, syncStatus }) => {
    const [editGroupName, setEditGroupName] = useState(group.name);
    const [editGroupDescription, setEditGroupDescription] = useState(group.description || '');
    const [isEditingGroup, setIsEditingGroup] = useState(false);

    // –°—Ç–∞–Ω –¥–ª—è –Ω–æ–≤–æ–≥–æ —Ç–æ–≤–∞—Ä—É
    const [newProduct, setNewProduct] = useState({
      name: '',
      description: '',
      manufacturer: '',
      quantity: 0,
      price: 0
    });

    const handleUpdateGroup = () => {
      onUpdateGroup(group.id, editGroupName.trim(), editGroupDescription.trim());
      setIsEditingGroup(false);
    };

    const handleAddProduct = () => {
      if (newProduct.name.trim() === "") return;
      onAddProduct(group.id, newProduct);
      setNewProduct({
        name: '',
        description: '',
        manufacturer: '',
        quantity: 0,
        price: 0
      });
    };

    const groupTotal = group.products.reduce((sum, product) =>
      sum + (product.quantity || 0) * (product.price || 0), 0);

    return (
      <div className="group">
        <div className={`sync-indicator ${syncStatus}`}></div>

        <div className="group-header">
          {isEditingGroup ? (
            <div style={{ display: 'flex', gap: '10px', alignItems: 'center', flexWrap: 'wrap' }}>
              <input
                type="text"
                value={editGroupName}
                onChange={(e) => setEditGroupName(e.target.value)}
                placeholder="–ù–∞–∑–≤–∞ –≥—Ä—É–ø–∏"
              />
              <input
                type="text"
                value={editGroupDescription}
                onChange={(e) => setEditGroupDescription(e.target.value)}
                placeholder="–û–ø–∏—Å –≥—Ä—É–ø–∏"
              />
              <button onClick={handleUpdateGroup}>üíæ –ó–±–µ—Ä–µ–≥—Ç–∏</button>
              <button onClick={() => setIsEditingGroup(false)}>‚ùå –°–∫–∞—Å—É–≤–∞—Ç–∏</button>
            </div>
          ) : (
            <>
              <div>
                <h3>üì¶ {group.name}</h3>
                {group.description && <p style={{ margin: '5px 0', color: '#666' }}>{group.description}</p>}
                <small style={{ color: '#888' }}>
                  –¢–æ–≤–∞—Ä—ñ–≤: {group.products.length} | –í–∞—Ä—Ç—ñ—Å—Ç—å: {groupTotal.toFixed(2)} ‚Ç¥
                </small>
              </div>
              <div>
                <button onClick={() => setIsEditingGroup(true)}>‚úèÔ∏è –†–µ–¥–∞–≥—É–≤–∞—Ç–∏</button>
                <button onClick={() => onDeleteGroup(group.id)}>üóëÔ∏è –í–∏–¥–∞–ª–∏—Ç–∏</button>
              </div>
            </>
          )}
        </div>

        {/* –§–æ—Ä–º–∞ –¥–æ–¥–∞–≤–∞–Ω–Ω—è —Ç–æ–≤–∞—Ä—É */}
        <div className="product-form">
          <h4>‚ûï –î–æ–¥–∞—Ç–∏ —Ç–æ–≤–∞—Ä –¥–æ –≥—Ä—É–ø–∏</h4>
          <div className="form-row">
            <input
              type="text"
              placeholder="–ù–∞–∑–≤–∞ —Ç–æ–≤–∞—Ä—É"
              value={newProduct.name}
              onChange={(e) => setNewProduct({...newProduct, name: e.target.value})}
            />
            <input
              type="text"
              placeholder="–û–ø–∏—Å"
              value={newProduct.description}
              onChange={(e) => setNewProduct({...newProduct, description: e.target.value})}
            />
            <input
              type="text"
              placeholder="–í–∏—Ä–æ–±–Ω–∏–∫"
              value={newProduct.manufacturer}
              onChange={(e) => setNewProduct({...newProduct, manufacturer: e.target.value})}
            />
            <input
              type="number"
              placeholder="–ö—ñ–ª—å–∫—ñ—Å—Ç—å"
              value={newProduct.quantity}
              onChange={(e) => setNewProduct({...newProduct, quantity: parseInt(e.target.value) || 0})}
            />
            <input
              type="number"
              step="0.01"
              placeholder="–¶—ñ–Ω–∞"
              value={newProduct.price}
              onChange={(e) => setNewProduct({...newProduct, price: parseFloat(e.target.value) || 0})}
            />
            <button onClick={handleAddProduct} disabled={!newProduct.name.trim()}>
              ‚ûï –î–æ–¥–∞—Ç–∏ —Ç–æ–≤–∞—Ä
            </button>
          </div>
        </div>

        {/* –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä—ñ–≤ */}
        {group.products.map(product => (
          <Product
            key={product.id}
            product={product}
            groupId={group.id}
            onUpdateProduct={onUpdateProduct}
            onDeleteProduct={onDeleteProduct}
            syncStatus={syncStatus}
          />
        ))}
      </div>
    );
  };

  const Product = ({ product, groupId, onUpdateProduct, onDeleteProduct, syncStatus }) => {
    const [isEditing, setIsEditing] = useState(false);
    const [editData, setEditData] = useState({
      name: product.name || '',
      description: product.description || '',
      manufacturer: product.manufacturer || '',
      quantity: product.quantity || 0,
      price: product.price || 0
    });

    const handleUpdate = () => {
      onUpdateProduct(groupId, product.id, editData);
      setIsEditing(false);
    };

    const productTotal = (editData.quantity || 0) * (editData.price || 0);

    return (
      <div className="product">
        <div className={`sync-indicator ${syncStatus}`}></div>

        {isEditing ? (
          <div>
            <h4>‚úèÔ∏è –†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è —Ç–æ–≤–∞—Ä—É</h4>
            <div className="form-row">
              <input
                type="text"
                placeholder="–ù–∞–∑–≤–∞"
                value={editData.name}
                onChange={(e) => setEditData({...editData, name: e.target.value})}
              />
              <input
                type="text"
                placeholder="–û–ø–∏—Å"
                value={editData.description}
                onChange={(e) => setEditData({...editData, description: e.target.value})}
              />
              <input
                type="text"
                placeholder="–í–∏—Ä–æ–±–Ω–∏–∫"
                value={editData.manufacturer}
                onChange={(e) => setEditData({...editData, manufacturer: e.target.value})}
              />
              <input
                type="number"
                placeholder="–ö—ñ–ª—å–∫—ñ—Å—Ç—å"
                value={editData.quantity}
                onChange={(e) => setEditData({...editData, quantity: parseInt(e.target.value) || 0})}
              />
              <input
                type="number"
                step="0.01"
                placeholder="–¶—ñ–Ω–∞"
                value={editData.price}
                onChange={(e) => setEditData({...editData, price: parseFloat(e.target.value) || 0})}
              />
            </div>
            <p><strong>–ó–∞–≥–∞–ª—å–Ω–∞ –≤–∞—Ä—Ç—ñ—Å—Ç—å: {productTotal.toFixed(2)} ‚Ç¥</strong></p>
            <button onClick={handleUpdate}>üíæ –ó–±–µ—Ä–µ–≥—Ç–∏</button>
            <button onClick={() => setIsEditing(false)}>‚ùå –°–∫–∞—Å—É–≤–∞—Ç–∏</button>
          </div>
        ) : (
          <div className="product-header">
            <div>
              <h4>üõçÔ∏è {product.name}</h4>
              {product.description && <p style={{ margin: '5px 0', color: '#666' }}>{product.description}</p>}
              <div style={{ display: 'flex', gap: '15px', flexWrap: 'wrap', marginTop: '10px' }}>
                {product.manufacturer && <span>üè≠ {product.manufacturer}</span>}
                <span>üì¶ {product.quantity || 0} —à—Ç.</span>
                <span>üí∞ {product.price || 0} ‚Ç¥/—à—Ç.</span>
                <span style={{ fontWeight: 'bold', color: '#667eea' }}>
                  üíµ –í—Å—å–æ–≥–æ: {((product.quantity || 0) * (product.price || 0)).toFixed(2)} ‚Ç¥
                </span>
              </div>
            </div>
            <div>
              <button onClick={() => setIsEditing(true)}>‚úèÔ∏è –†–µ–¥–∞–≥—É–≤–∞—Ç–∏</button>
              <button onClick={() => onDeleteProduct(groupId, product.id)}>üóëÔ∏è –í–∏–¥–∞–ª–∏—Ç–∏</button>
            </div>
          </div>
        )}
      </div>
    );
  };

  ReactDOM.createRoot(document.getElementById("root")).render(<App />);
</script>
</body>
</html>