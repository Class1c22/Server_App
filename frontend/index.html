<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Å–∫–ª–∞–¥–æ–º</title>
  <style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: Arial, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
    }

    .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        overflow: hidden;
    }

    .header {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        color: white;
        padding: 20px;
        text-align: center;
    }

    .tabs {
        display: flex;
        background: #f8f9fa;
        border-bottom: 1px solid #dee2e6;
    }

    .tab {
        flex: 1;
        padding: 15px;
        text-align: center;
        cursor: pointer;
        background: #f8f9fa;
        border: none;
        transition: all 0.3s;
    }

    .tab:hover {
        background: #e9ecef;
    }

    .tab.active {
        background: #007bff;
        color: white;
    }

    .tab-content {
        display: none;
        padding: 20px;
    }

    .tab-content.active {
        display: block;
    }

    .form-group {
        margin-bottom: 15px;
    }

    label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
        color: #333;
    }

    input, select, textarea {
        width: 100%;
        padding: 10px;
        border: 2px solid #ddd;
        border-radius: 8px;
        font-size: 14px;
        transition: border-color 0.3s;
    }

    input:focus, select:focus, textarea:focus {
        outline: none;
        border-color: #007bff;
    }

    button {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 12px 24px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        transition: transform 0.2s;
        margin-right: 10px;
        margin-bottom: 10px;
    }

    button:hover {
        transform: translateY(-2px);
    }

    .btn-danger {
        background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
    }

    .btn-success {
        background: linear-gradient(135deg, #5ee7df 0%, #66a6ff 100%);
    }

    .data-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
    }

    .data-table th, .data-table td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid #ddd;
    }

    .data-table th {
        background: #f8f9fa;
        font-weight: bold;
    }

    .data-table tbody tr:nth-child(even) {
        background: #f8f9fa;
    }

    .data-table tbody tr:hover {
        background: #e3f2fd;
    }

    .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.5);
    }

    .modal-content {
        background-color: white;
        margin: 5% auto;
        padding: 20px;
        border-radius: 15px;
        width: 90%;
        max-width: 500px;
        max-height: 80vh;
        overflow-y: auto;
    }

    .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
    }

    .close:hover {
        color: black;
    }

    .message {
        padding: 10px;
        margin: 10px 0;
        border-radius: 5px;
        display: none;
    }

    .message.success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
    }

    .message.error {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
    }

    .form-row {
        display: flex;
        gap: 15px;
    }

    .form-row .form-group {
        flex: 1;
    }

    .stock-operations {
        display: flex;
        gap: 10px;
        align-items: center;
    }

    .stock-operations input {
        width: 80px;
    }
  </style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>üè™ –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Å–∫–ª–∞–¥–æ–º</h1>
    <p>–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Ç–æ–≤–∞—Ä–∞–º–∏ —Ç–∞ –≥—Ä—É–ø–∞–º–∏ —Ç–æ–≤–∞—Ä—ñ–≤</p>
  </div>

  <div class="tabs">
    <button class="tab active" onclick="showTab('groups')">üì¶ –ì—Ä—É–ø–∏ —Ç–æ–≤–∞—Ä—ñ–≤</button>
    <button class="tab" onclick="showTab('products')">üõçÔ∏è –¢–æ–≤–∞—Ä–∏</button>
    <button class="tab" onclick="showTab('stock')">üìä –°–∫–ª–∞–¥</button>
  </div>

  <!-- –ì—Ä—É–ø–∏ —Ç–æ–≤–∞—Ä—ñ–≤ -->
  <div id="groups" class="tab-content active">
    <h2>–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –≥—Ä—É–ø–∞–º–∏ —Ç–æ–≤–∞—Ä—ñ–≤</h2>

    <div class="form-group" style="max-width: 300px; margin-bottom:10px;">
      <input type="text" id="groupSearch" placeholder="üîç –ü–æ—à—É–∫..." oninput="displayGroups(this.value)">
    </div>

    <button onclick="openAddGroupModal()">‚ûï –î–æ–¥–∞—Ç–∏ –≥—Ä—É–ø—É</button>
    <button onclick="loadGroups()">üîÑ –û–Ω–æ–≤–∏—Ç–∏</button>

    <div id="groupsMessage" class="message"></div>

    <table class="data-table" id="groupsTable">
      <thead>
      <tr>
        <th>ID</th>
        <th>–ù–∞–∑–≤–∞</th>
        <th>–û–ø–∏—Å</th>
        <th>–î—ñ—ó</th>
      </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- –¢–æ–≤–∞—Ä–∏ -->
  <div id="products" class="tab-content">
    <h2>–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Ç–æ–≤–∞—Ä–∞–º–∏</h2>

    <div class="form-group" style="max-width: 300px; margin-bottom:10px;">
      <input type="text" id="productSearch" placeholder="üîç –ü–æ—à—É–∫..." oninput="displayProducts(this.value)">
    </div>

    <button onclick="openAddProductModal()">‚ûï –î–æ–¥–∞—Ç–∏ —Ç–æ–≤–∞—Ä</button>
    <button onclick="loadProducts()">üîÑ –û–Ω–æ–≤–∏—Ç–∏</button>

    <div id="productsMessage" class="message"></div>

    <table class="data-table" id="productsTable">
      <thead>
      <tr>
        <th>ID</th>
        <th>–ù–∞–∑–≤–∞</th>
        <th>–ì—Ä—É–ø–∞</th>
        <th>–í–∏—Ä–æ–±–Ω–∏–∫</th>
        <th>–ö—ñ–ª—å–∫—ñ—Å—Ç—å</th>
        <th>–¶—ñ–Ω–∞</th>
        <th>–î—ñ—ó</th>
      </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- –°–∫–ª–∞–¥ -->
  <div id="stock" class="tab-content">
    <h2>–û–ø–µ—Ä–∞—Ü—ñ—ó –∑—ñ —Å–∫–ª–∞–¥–æ–º</h2>

    <button onclick="loadProducts()">üîÑ –û–Ω–æ–≤–∏—Ç–∏ –¥–∞–Ω—ñ</button>

    <div id="stockMessage" class="message"></div>

    <table class="data-table" id="stockTable">
      <thead>
      <tr>
        <th>–¢–æ–≤–∞—Ä</th>
        <th>–ì—Ä—É–ø–∞</th>
        <th>–ü–æ—Ç–æ—á–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å</th>
        <th>–¶—ñ–Ω–∞ –∑–∞ —à—Ç.</th>
        <th>–í–∞—Ä—Ç—ñ—Å—Ç—å</th>
        <th>–û–ø–µ—Ä–∞—Ü—ñ—ó</th>
      </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω—ñ –≤—ñ–∫–Ω–∞ -->

<!-- –î–æ–¥–∞—Ç–∏/—Ä–µ–¥–∞–≥—É–≤–∞—Ç–∏ –≥—Ä—É–ø—É -->
<div id="groupModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('groupModal')">&times;</span>
    <h2 id="groupModalTitle">–î–æ–¥–∞—Ç–∏ –≥—Ä—É–ø—É</h2>
    <form id="groupForm">
      <input type="hidden" id="groupId">
      <div class="form-group">
        <label for="groupName">–ù–∞–∑–≤–∞ –≥—Ä—É–ø–∏:</label>
        <input type="text" id="groupName" required>
      </div>
      <div class="form-group">
        <label for="groupDescription">–û–ø–∏—Å:</label>
        <textarea id="groupDescription" rows="3"></textarea>
      </div>
      <button type="submit">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
      <button type="button" onclick="closeModal('groupModal')">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
    </form>
  </div>
</div>

<!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –≥—Ä—É–ø—ñ -->
<div id="groupStatsModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('groupStatsModal')">&times;</span>
    <h2 id="groupStatsTitle">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≥—Ä—É–ø–∏</h2>
    <table class="data-table" id="groupStatsTable">
      <thead>
        <tr>
          <th>ID</th>
          <th>–ù–∞–∑–≤–∞</th>
          <th>–ö—ñ–ª—å–∫—ñ—Å—Ç—å</th>
          <th>–¶—ñ–Ω–∞ –∑–∞ —à—Ç.</th>
          <th>–í–∞—Ä—Ç—ñ—Å—Ç—å</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <p style="margin-top:10px;font-weight:bold;" id="groupTotalValue"></p>
  </div>
</div>

<!-- –î–æ–¥–∞—Ç–∏/—Ä–µ–¥–∞–≥—É–≤–∞—Ç–∏ —Ç–æ–≤–∞—Ä -->
<div id="productModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('productModal')">&times;</span>
    <h2 id="productModalTitle">–î–æ–¥–∞—Ç–∏ —Ç–æ–≤–∞—Ä</h2>
    <form id="productForm">
      <input type="hidden" id="productId">
      <div class="form-group">
        <label for="productName">–ù–∞–∑–≤–∞ —Ç–æ–≤–∞—Ä—É:</label>
        <input type="text" id="productName" required>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="productGroup">–ì—Ä—É–ø–∞:</label>
          <select id="productGroup" required>
            <option value="">–û–±–µ—Ä—ñ—Ç—å –≥—Ä—É–ø—É</option>
          </select>
        </div>
        <div class="form-group">
          <label for="productManufacturer">–í–∏—Ä–æ–±–Ω–∏–∫:</label>
          <input type="text" id="productManufacturer">
        </div>
      </div>
      <div class="form-group">
        <label for="productDescription">–û–ø–∏—Å:</label>
        <textarea id="productDescription" rows="3"></textarea>
      </div>
      <div class="form-group">
        <label for="productPrice">–¶—ñ–Ω–∞ –∑–∞ –æ–¥–∏–Ω–∏—Ü—é:</label>
        <input type="number" id="productPrice" step="0.01" min="0" required>
      </div>
      <button type="submit">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
      <button type="button" onclick="closeModal('productModal')">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
    </form>
  </div>
</div>

<script>
  const API_BASE = 'http://localhost:8081';
  let groups = [];
  let products = [];

  // –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –≤–∫–ª–∞–¥–∫–∞–º–∏
  function showTab(tabName) {
      document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

      event.target.classList.add('active');
      document.getElementById(tabName).classList.add('active');

      if (tabName === 'groups') loadGroups();
      if (tabName === 'products') loadProducts();
      if (tabName === 'stock') loadProducts();
  }

  // –£—Ç–∏–ª—ñ—Ç–∞—Ä–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó
  function showMessage(elementId, message, type) {
      const el = document.getElementById(elementId);
      el.textContent = message;
      el.className = `message ${type}`;
      el.style.display = 'block';
      setTimeout(() => el.style.display = 'none', 5000);
  }

  function openModal(modalId) {
      document.getElementById(modalId).style.display = 'block';
  }

  function closeModal(modalId) {
      document.getElementById(modalId).style.display = 'none';
  }

  // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö
  async function loadGroups() {
      try {
          const response = await fetch(`${API_BASE}/groups`);
          groups = await response.json();
          displayGroups();
          updateProductGroupSelect();
      } catch (error) {
          showMessage('groupsMessage', '–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≥—Ä—É–ø: ' + error.message, 'error');
      }
  }

  async function loadProducts() {
      try {
          const response = await fetch(`${API_BASE}/products`);
          products = await response.json();
          displayProducts();
          displayStock();
      } catch (error) {
          showMessage('productsMessage', '–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç–æ–≤–∞—Ä—ñ–≤: ' + error.message, 'error');
      }
  }

  // –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –≥—Ä—É–ø –∑ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—î—é
  function displayGroups(search = undefined) {
      if (search === undefined) {
          const inp = document.getElementById('groupSearch');
          search = inp ? inp.value : '';
      }
      search = (search || '').toLowerCase();

      const tbody = document.querySelector('#groupsTable tbody');
      tbody.innerHTML = '';

      const filteredGroups = groups.filter(group => {
          return Object.values(group).some(val => String(val).toLowerCase().includes(search));
      });

      filteredGroups.forEach(group => {
          const row = document.createElement('tr');
          row.innerHTML = `
              <td>${group.id}</td>
              <td>${group.name}</td>
              <td>${group.description || ''}</td>
              <td>
                  <button onclick="editGroup(${group.id})" class="btn-success">‚úèÔ∏è –†–µ–¥–∞–≥—É–≤–∞—Ç–∏</button>
                  <button onclick="openGroupStats(${group.id})" class="btn-success">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
                  <button onclick="deleteGroup(${group.id})" class="btn-danger">üóëÔ∏è –í–∏–¥–∞–ª–∏—Ç–∏</button>
              </td>
          `;
          tbody.appendChild(row);
      });
  }

  // –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Ç–æ–≤–∞—Ä—ñ–≤ –∑ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—î—é
  function displayProducts(search = undefined) {
      if (search === undefined) {
          const inp = document.getElementById('productSearch');
          search = inp ? inp.value : '';
      }
      search = (search || '').toLowerCase();

      const tbody = document.querySelector('#productsTable tbody');
      tbody.innerHTML = '';

      const filteredProducts = products.filter(product => {
          const group = groups.find(g => g.id === product.groupId);
          return [product.id, product.name, product.manufacturer, product.quantity, product.pricePerUnit,
                  group ? group.name : ''].some(val => String(val).toLowerCase().includes(search));
      });

      filteredProducts.forEach(product => {
          const group = groups.find(g => g.id === product.groupId);
          const row = document.createElement('tr');
          row.innerHTML = `
              <td>${product.id}</td>
              <td>${product.name}</td>
              <td>${group ? group.name : '–ù–µ–≤—ñ–¥–æ–º–∞ –≥—Ä—É–ø–∞'}</td>
              <td>${product.manufacturer || ''}</td>
              <td>${product.quantity}</td>
              <td>${product.pricePerUnit} –≥—Ä–Ω</td>
              <td>
                  <button onclick="editProduct(${product.id})" class="btn-success">‚úèÔ∏è –†–µ–¥–∞–≥—É–≤–∞—Ç–∏</button>
                  <button onclick="deleteProduct(${product.id})" class="btn-danger">üóëÔ∏è –í–∏–¥–∞–ª–∏—Ç–∏</button>
              </td>
          `;
          tbody.appendChild(row);
      });
  }

  // –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Å–∫–ª–∞–¥—Å—å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π
  function displayStock() {
      const tbody = document.querySelector('#stockTable tbody');
      tbody.innerHTML = '';

      let totalStockValue = 0;

      products.forEach(product => {
          const group = groups.find(g => g.id === product.groupId);
          const row = document.createElement('tr');
          row.innerHTML = `
              <td>${product.name}</td>
              <td>${group ? group.name : '–ù–µ–≤—ñ–¥–æ–º–∞ –≥—Ä—É–ø–∞'}</td>
              <td><strong>${product.quantity}</strong></td>
              <td>${product.pricePerUnit} –≥—Ä–Ω</td>
              <td>${(product.quantity * product.pricePerUnit).toFixed(2)} –≥—Ä–Ω</td>
              <td class="stock-operations">
                  <input type="number" id="addQty_${product.id}" min="1" placeholder="–ö—ñ–ª—å–∫—ñ—Å—Ç—å">
                  <button onclick="addStock(${product.id})" class="btn-success">‚ûï –î–æ–¥–∞—Ç–∏</button>
                  <input type="number" id="removeQty_${product.id}" min="1" max="${product.quantity}" placeholder="–ö—ñ–ª—å–∫—ñ—Å—Ç—å">
                  <button onclick="removeStock(${product.id})" class="btn-danger">‚ûñ –°–ø–∏—Å–∞—Ç–∏</button>
              </td>
          `;
          tbody.appendChild(row);
          totalStockValue += product.quantity * product.pricePerUnit;
      });

      // –ü—ñ–¥—Å—É–º–æ–∫
      const summaryRow = document.createElement('tr');
      summaryRow.innerHTML = `
          <td colspan="4" style="text-align:right;font-weight:bold;">–ó–∞–≥–∞–ª—å–Ω–∞ –≤–∞—Ä—Ç—ñ—Å—Ç—å:</td>
          <td colspan="2" style="font-weight:bold;">${totalStockValue.toFixed(2)} –≥—Ä–Ω</td>
      `;
      tbody.appendChild(summaryRow);
  }

  // –û–ø–µ—Ä–∞—Ü—ñ—ó –∑ –≥—Ä—É–ø–∞–º–∏
  function openAddGroupModal() {
      document.getElementById('groupModalTitle').textContent = '–î–æ–¥–∞—Ç–∏ –≥—Ä—É–ø—É';
      document.getElementById('groupForm').reset();
      document.getElementById('groupId').value = '';
      openModal('groupModal');
  }

  async function editGroup(id) {
      const group = groups.find(g => g.id === id);
      if (!group) return;

      document.getElementById('groupModalTitle').textContent = '–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –≥—Ä—É–ø—É';
      document.getElementById('groupId').value = group.id;
      document.getElementById('groupName').value = group.name;
      document.getElementById('groupDescription').value = group.description || '';
      openModal('groupModal');
  }

  async function deleteGroup(id) {
      if (!confirm('–í–∏–¥–∞–ª–∏—Ç–∏ –≥—Ä—É–ø—É? –í—Å—ñ —Ç–æ–≤–∞—Ä–∏ –≤ —Ü—ñ–π –≥—Ä—É–ø—ñ —Ç–∞–∫–æ–∂ –±—É–¥—É—Ç—å –≤–∏–¥–∞–ª–µ–Ω—ñ!')) return;

      try {
          const response = await fetch(`${API_BASE}/delete-group`, {
              method: 'DELETE',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ id })
          });

          if (response.ok) {
              showMessage('groupsMessage', '–ì—Ä—É–ø—É —É—Å–ø—ñ—à–Ω–æ –≤–∏–¥–∞–ª–µ–Ω–æ', 'success');
              loadGroups();
          } else {
              const error = await response.text();
              showMessage('groupsMessage', '–ü–æ–º–∏–ª–∫–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è: ' + error, 'error');
          }
      } catch (error) {
          showMessage('groupsMessage', '–ü–æ–º–∏–ª–∫–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è: ' + error.message, 'error');
      }
  }

  // –û–ø–µ—Ä–∞—Ü—ñ—ó –∑ —Ç–æ–≤–∞—Ä–∞–º–∏
  function openAddProductModal() {
      document.getElementById('productModalTitle').textContent = '–î–æ–¥–∞—Ç–∏ —Ç–æ–≤–∞—Ä';
      document.getElementById('productForm').reset();
      document.getElementById('productId').value = '';
      openModal('productModal');
  }

  async function editProduct(id) {
      const product = products.find(p => p.id === id);
      if (!product) return;

      document.getElementById('productModalTitle').textContent = '–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ —Ç–æ–≤–∞—Ä';
      document.getElementById('productId').value = product.id;
      document.getElementById('productName').value = product.name;
      document.getElementById('productGroup').value = product.groupId;
      document.getElementById('productManufacturer').value = product.manufacturer || '';
      document.getElementById('productDescription').value = product.description || '';
      document.getElementById('productPrice').value = product.pricePerUnit;
      openModal('productModal');
  }

  async function deleteProduct(id) {
      if (!confirm('–í–∏–¥–∞–ª–∏—Ç–∏ —Ç–æ–≤–∞—Ä?')) return;

      try {
          const response = await fetch(`${API_BASE}/delete-product`, {
              method: 'DELETE',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ id })
          });

          if (response.ok) {
              showMessage('productsMessage', '–¢–æ–≤–∞—Ä —É—Å–ø—ñ—à–Ω–æ –≤–∏–¥–∞–ª–µ–Ω–æ', 'success');
              loadProducts();
          } else {
              const error = await response.text();
              showMessage('productsMessage', '–ü–æ–º–∏–ª–∫–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è: ' + error, 'error');
          }
      } catch (error) {
          showMessage('productsMessage', '–ü–æ–º–∏–ª–∫–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è: ' + error.message, 'error');
      }
  }

  // –°–∫–ª–∞–¥—Å—å–∫—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó
  async function addStock(productId) {
      const qtyInput = document.getElementById(`addQty_${productId}`);
      const quantity = parseInt(qtyInput.value);

      if (!quantity || quantity <= 0) {
          showMessage('stockMessage', '–í–≤–µ–¥—ñ—Ç—å –∫–æ—Ä–µ–∫—Ç–Ω—É –∫—ñ–ª—å–∫—ñ—Å—Ç—å', 'error');
          return;
      }

      try {
          const response = await fetch(`${API_BASE}/add-stock`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ productId, quantity })
          });

          if (response.ok) {
              showMessage('stockMessage', '–°–∫–ª–∞–¥ —É—Å–ø—ñ—à–Ω–æ –ø–æ–ø–æ–≤–Ω–µ–Ω–æ', 'success');
              qtyInput.value = '';
              loadProducts();
          } else {
              const error = await response.text();
              showMessage('stockMessage', '–ü–æ–º–∏–ª–∫–∞ –ø–æ–ø–æ–≤–Ω–µ–Ω–Ω—è: ' + error, 'error');
          }
      } catch (error) {
          showMessage('stockMessage', '–ü–æ–º–∏–ª–∫–∞ –ø–æ–ø–æ–≤–Ω–µ–Ω–Ω—è: ' + error.message, 'error');
      }
  }

  async function removeStock(productId) {
      const qtyInput = document.getElementById(`removeQty_${productId}`);
      const quantity = parseInt(qtyInput.value);

      if (!quantity || quantity <= 0) {
          showMessage('stockMessage', '–í–≤–µ–¥—ñ—Ç—å –∫–æ—Ä–µ–∫—Ç–Ω—É –∫—ñ–ª—å–∫—ñ—Å—Ç—å', 'error');
          return;
      }

      try {
          const response = await fetch(`${API_BASE}/remove-stock`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ productId, quantity })
          });

          if (response.ok) {
              showMessage('stockMessage', '–¢–æ–≤–∞—Ä —É—Å–ø—ñ—à–Ω–æ —Å–ø–∏—Å–∞–Ω–æ', 'success');
              qtyInput.value = '';
              loadProducts();
          } else {
              const error = await response.text();
              showMessage('stockMessage', '–ü–æ–º–∏–ª–∫–∞ —Å–ø–∏—Å–∞–Ω–Ω—è: ' + error, 'error');
          }
      } catch (error) {
          showMessage('stockMessage', '–ü–æ–º–∏–ª–∫–∞ —Å–ø–∏—Å–∞–Ω–Ω—è: ' + error.message, 'error');
      }
  }

  // –û–±—Ä–æ–±–∫–∞ —Ñ–æ—Ä–º
  document.getElementById('groupForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      const groupData = {
          name: document.getElementById('groupName').value,
          description: document.getElementById('groupDescription').value
      };

      const groupId = document.getElementById('groupId').value;
      let url = `${API_BASE}/add-group`;
      let method = 'POST';

      if (groupId) {
          url = `${API_BASE}/update-group`;
          method = 'PUT';
          groupData.id = parseInt(groupId);
      }

      try {
          const response = await fetch(url, {
              method,
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(groupData)
          });

          if (response.ok) {
              showMessage('groupsMessage', groupId ? '–ì—Ä—É–ø—É –æ–Ω–æ–≤–ª–µ–Ω–æ' : '–ì—Ä—É–ø—É –¥–æ–¥–∞–Ω–æ', 'success');
              closeModal('groupModal');
              loadGroups();
          } else {
              const error = await response.text();
              showMessage('groupsMessage', '–ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è: ' + error, 'error');
          }
      } catch (error) {
          showMessage('groupsMessage', '–ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è: ' + error.message, 'error');
      }
  });

  document.getElementById('productForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      const productData = {
          name: document.getElementById('productName').value,
          groupId: parseInt(document.getElementById('productGroup').value),
          manufacturer: document.getElementById('productManufacturer').value,
          description: document.getElementById('productDescription').value,
          price: document.getElementById('productPrice').value
      };

      const productId = document.getElementById('productId').value;
      let url = `${API_BASE}/add-product`;
      let method = 'POST';

      if (productId) {
          url = `${API_BASE}/update-product`;
          method = 'PUT';
          productData.id = parseInt(productId);
      }

      try {
          const response = await fetch(url, {
              method,
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(productData)
          });

          if (response.ok) {
              showMessage('productsMessage', productId ? '–¢–æ–≤–∞—Ä –æ–Ω–æ–≤–ª–µ–Ω–æ' : '–¢–æ–≤–∞—Ä –¥–æ–¥–∞–Ω–æ', 'success');
              closeModal('productModal');
              loadProducts();
          } else {
              const error = await response.text();
              showMessage('productsMessage', '–ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è: ' + error, 'error');
          }
      } catch (error) {
          showMessage('productsMessage', '–ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è: ' + error.message, 'error');
      }
  });

  // –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å–µ–ª–µ–∫—Ç—É –≥—Ä—É–ø —É —Ñ–æ—Ä–º—ñ —Ç–æ–≤–∞—Ä—É
  function updateProductGroupSelect() {
      const select = document.getElementById('productGroup');
      select.innerHTML = '<option value="">–û–±–µ—Ä—ñ—Ç—å –≥—Ä—É–ø—É</option>';

      groups.forEach(group => {
          const option = document.createElement('option');
          option.value = group.id;
          option.textContent = group.name;
          select.appendChild(option);
      });
  }

  // –ó–∞–∫—Ä–∏—Ç—Ç—è –º–æ–¥–∞–ª—å–Ω–∏—Ö –≤—ñ–∫–æ–Ω –ø—Ä–∏ –∫–ª—ñ–∫—É –ø–æ–∑–∞ –Ω–∏–º–∏
  window.onclick = function(event) {
      if (event.target.classList.contains('modal')) {
          event.target.style.display = 'none';
      }
  }

  // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≥—Ä—É–ø–∏
  function openGroupStats(groupId) {
      const group = groups.find(g => g.id === groupId);
      if (!group) return;
      document.getElementById('groupStatsTitle').textContent = `–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≥—Ä—É–ø–∏: ${group.name}`;

      const tbody = document.querySelector('#groupStatsTable tbody');
      tbody.innerHTML = '';
      let total = 0;

      const groupProducts = products.filter(p => p.groupId === groupId);
      groupProducts.forEach(p => {
          const row = document.createElement('tr');
          const value = p.quantity * p.pricePerUnit;
          total += value;
          row.innerHTML = `
              <td>${p.id}</td>
              <td>${p.name}</td>
              <td>${p.quantity}</td>
              <td>${p.pricePerUnit} –≥—Ä–Ω</td>
              <td>${value.toFixed(2)} –≥—Ä–Ω</td>
          `;
          tbody.appendChild(row);
      });
      document.getElementById('groupTotalValue').textContent = `–ó–∞–≥–∞–ª—å–Ω–∞ –≤–∞—Ä—Ç—ñ—Å—Ç—å —Ç–æ–≤–∞—Ä—ñ–≤ —É –≥—Ä—É–ø—ñ: ${total.toFixed(2)} –≥—Ä–Ω`;
      openModal('groupStatsModal');
  }

  // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
  document.addEventListener('DOMContentLoaded', () => {
      loadGroups();
      // –ü—ñ–¥–∫–ª—é—á–∞—î–º–æ —Å–ª—É—Ö–∞—á—ñ –≤–≤–æ–¥—É –¥–ª—è –ø–æ—à—É–∫—É
      const gInp = document.getElementById('groupSearch');
      if (gInp) gInp.addEventListener('input', () => displayGroups(gInp.value));
      const pInp = document.getElementById('productSearch');
      if (pInp) pInp.addEventListener('input', () => displayProducts(pInp.value));
  });
</script>
</body>
</html>